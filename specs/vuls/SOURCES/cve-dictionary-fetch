#!/bin/bash

################################################################################

main() {
  if [[ $# -ne 2 ]] ; then
    echo "Usage: cve-dictionary-fetch {data-dir} {year}"
    exit 0
  fi

  local dir="$1"
  local year="$2"

  if [[ ! -e "$dir" || ! -d "$dir" ]] ; then
    echo "Wrong path to data directory"
    exit 1
  fi

  fetch "$dir" "$year"
}

fetch() {
  local dir="$1"
  local years="$2"
  local year

  if [[ "$years" == "all" ]] ; then
    years=$(getAllYears)
  elif [[ "$years" == "current" ]] ; then
    years=$(date +%Y)
  fi

  for year in $years ; do
    go-cve-dictionary fetchnvd -dbpath "$dir/cve.sqlite3" -years "$year"

    [[ $? -ne 0 ]] && exit 1
  done

  for year in $years ; do
    go-cve-dictionary fetchjvn -dbpath "$dir/cve.sqlite3" -years "$year"

    [[ $? -ne 0 ]] && exit 1
  done
}

getAllYears() {
  seq 2012 $(date +%Y) | tr '\n' ' ' | sed 's/ $//'
}

################################################################################

main "$@"
